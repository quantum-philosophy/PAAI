Let us now draw attention to the following concern. Imagine a function that is
nearly flat on the first half of $[0, 1]$ and rather irregular on the other.
Under these circumstances, it is natural to expect that, in order to attain the
same accuracy, the first half would require much fewer collocation nodes than
the other one; recall the example given in \fref{motivation}. However, if we
followed the construction procedure described so far, we would not be able to
benefit from this behavior: we would treat both sides equally and would add all
the nodes of each level.

The solution to the above problem is to make the interpolation algorithm
adaptive. First, we need to find a way to measure how good our approximation is
at any point in the domain of $\f$. Then, when traversing from level $\l - 1$ to
level $\l$, instead of bombarding $\f$ with all the nodes in $\Y_\l \setminus
\Y_{\l - 1}$ (see \eref{smolyak-grid-incremental}), we will take only on those
new nodes that are located in the regions with poor accuracy identified by the
yet-to-be-found accuracy metric. This strategy practically means that the inner
sum in \eref{smolyak-hierarchical} will iterate over a subset of
$\Delta\index_\vi$.

Thanks to the hierarchical form obtained in the previous subsection, we already
have a good candidate for the accuracy metric. Recall \eref{surplus}.
Hierarchical surpluses are a natural indicator of the interpolation error: as
noted earlier, they are the difference between the true function and its
approximation at the nodes of the underlying sparse grid. Thus, after computing
the surpluses corresponding to the nodes of one level, we can recycle their
values in order to decide which of the nodes are to be refined, that is, which
of the nodes of the next level are to be included in the interpolant. The
meaning of refinement will be discussed further in \sref{collocation-nodes}; for
the moment, we are only concerned with identifying ``problematic'' nodes.

First of all, looking at \eref{smolyak-hierarchical}, it is not clear what the
interpolation level $\l$ should be in order to achieve a certain accuracy level.
When should we stop?

In this regards, one can adhere to various strategies \cite{ma2009}. One of them
is as follows. Let $\error$ be the threshold of the absolute error that
represents the accuracy requirement of the problem at hand. Then, a collocation
node $\vx_{\vi\vj}$ is to be refined if
\begin{equation} \elab{error}
  \left| \surplus(\vx_{\vi\vj}) \right| > \error
\end{equation}
where $\surplus(\vx_{\vi\vj})$ is given by \eref{surplus}. We shall use this
criterion in the experiment results reported in \sref{experimental-results}.

To summarize, assuming that collocation points and basis functions have been
carefully chosen, we have obtained an efficient algorithm for adaptive
hierarchical interpolation in multiple dimensions. The main equations are
\eref{surplus} and \eref{smolyak-hierarchical} where $\Delta\index_\vi$ is
generally replaced by its subset according to a local adaptation strategy such
as the one in \eref{error}.
